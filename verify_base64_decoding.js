// Mocking the fileToBase64 function from src/services/file-service.ts
// Note: We can't fully mock FileReader in Node.js environment without a polyfill or JSDOM.
// However, we can simulate the logic and check if the base64 string is valid.

function simulateFileToBase64(blob) {
    // In a browser, FileReader.readAsDataURL(blob) would return "data:mime/type;base64,..."
    // Here we just simulate the result.
    // If the blob was read correctly, the base64 part should be valid.
    
    // Let's assume we have a valid AVIF buffer
    // AVIF header: 00 00 00 1C 66 74 79 70 61 76 69 66 (AAAAHGZ0eXBhdmlm in base64)
    const avifBase64 = "AAAAHGZ0eXBhdmlm"; 
    return `data:application/octet-stream;base64,${avifBase64}`;
}

function parseDataUrl(url) {
    const match = url.match(/^data:([^;,]+)(?:;[^,]+)*;base64,(.+)$/i);
    if (!match) return null;
    return { mediaType: match[1], base64: match[2] };
}

// Test Case 1: Check if the base64 string from the log is valid base64
const logBase64 = "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";

try {
    const buffer = Buffer.from(logBase64, 'base64');
    console.log("Base64 decoding successful. Buffer length:", buffer.length);
    console.log("First 16 bytes (hex):", buffer.slice(0, 16).toString('hex'));
    console.log("First 16 bytes (ascii):", buffer.slice(0, 16).toString('ascii'));
} catch (e) {
    console.error("Base64 decoding failed:", e.message);
}

// Test Case 2: Verify if our magic number detection works on this specific string
if (logBase64.startsWith("AAAAHGZ0eXBhdmlm")) {
    console.log("Magic number detection: AVIF detected.");
} else {
    console.log("Magic number detection: AVIF NOT detected.");
}